<app-header [isHome]="false"></app-header>

<div
    class="flex max-w-screen-md flex-col text-sm items-center justify-start gap-8 w-full mx-auto my-8 !placeholder:text-zinc-400 min-h-[calc(100vh-8rem)]">
    <div class="flex flex-col items-center justify-center w-full gap-4 opacity-50 cursor-not-allowed">
        <div class="flex items-center justify-center w-full overflow-hidden rounded-full max-w-36 aspect-square ">
            <img *ngIf="avatarPreview != null" [src]="avatarPreview" alt="Avatar Preview"
                class="object-cover w-full h-full fill">
            <div *ngIf="avatarPreview == null" alt="Avatar Preview" class="w-full h-full p-4 bg-slate-700">
                <svg class="fill-zinc-200" xmlns="http://www.w3.org/2000/svg" width="112" height="112" fill=""
                    viewBox="0 0 256 256">
                    <path
                        d="M208,56H180.28L166.65,35.56A8,8,0,0,0,160,32H96a8,8,0,0,0-6.65,3.56L75.71,56H48A24,24,0,0,0,24,80V192a24,24,0,0,0,24,24H208a24,24,0,0,0,24-24V80A24,24,0,0,0,208,56Zm8,136a8,8,0,0,1-8,8H48a8,8,0,0,1-8-8V80a8,8,0,0,1,8-8H80a8,8,0,0,0,6.66-3.56L100.28,48h55.43l13.63,20.44A8,8,0,0,0,176,72h32a8,8,0,0,1,8,8ZM128,88a44,44,0,1,0,44,44A44.05,44.05,0,0,0,128,88Zm0,72a28,28,0,1,1,28-28A28,28,0,0,1,128,160Z">
                    </path>
                </svg>
            </div>
        </div>
        <ngx-file-drop class="" dropZoneLabel="Drop files here">
            <ng-template ngx-file-drop-content-tmp let-openFileSelector="openFileSelector"
                class="flex flex-col items-center justify-center gap-2 ">
                <button type="button"
                    class="flex flex-col items-center text-sm cursor-not-allowed text-zinc-400">Arraste ou explore
                    arquivos de imagem.
                    <span class="text-sm text-zinc-400"> No máximo 10MB nos foramtos .jpg, .png, .jpeg </span>
                </button>
            </ng-template>
        </ngx-file-drop>
    </div>

    <form (ngSubmit)="onSubmit()" [formGroup]="contactForm" class="flex flex-col w-full gap-4">

        <div class="flex flex-col">
            <div *ngIf="name?.invalid && name?.touched" class="flex flex-col text-red-500">
                <small *ngIf="name?.errors">Nome é obrigatório.</small>
            </div>
            <div *ngIf="phone?.invalid && phone?.touched" class="flex flex-col text-red-500">
                <small *ngIf="phone?.errors?.['required']">Telefone é obrigatório.</small>
                <small *ngIf="phone?.errors?.['pattern']">Telefone deve ser um número válido.</small>
            </div>
        </div>

        <div class="flex items-center justify-between gap-4">
            <div class="relative flex flex-col items-center justify-center w-full fill-zinc-400 group">
                <input type="text" id="name" required formControlName="name" name="name"
                    class="w-full h-10 px-2 pl-10 transition-colors duration-300 rounded-lg bg-slate-900 text-zinc-200 focus:outline-none focus:group-fill-zinc-200"
                    placeholder="Nome">
                <div
                    class="absolute transition-colors duration-300 left-2 fill-zinc-400 group-focus-within:fill-zinc-200">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="" viewBox="0 0 256 256">
                        <path
                            d="M230.92,212c-15.23-26.33-38.7-45.21-66.09-54.16a72,72,0,1,0-73.66,0C63.78,166.78,40.31,185.66,25.08,212a8,8,0,1,0,13.85,8c18.84-32.56,52.14-52,89.07-52s70.23,19.44,89.07,52a8,8,0,1,0,13.85-8ZM72,96a56,56,0,1,1,56,56A56.06,56.06,0,0,1,72,96Z">
                        </path>
                    </svg>
                </div>
            </div>
            <div class="relative flex flex-col items-center justify-center w-full fill-zinc-400 group">
                <input type="text" id="phone" required formControlName="phone" name="phone" mask="(00) 00000-0000"
                    class="w-full h-10 px-2 pl-10 transition-colors duration-300 rounded-lg bg-slate-900 text-zinc-200 focus:outline-none focus:group-fill-zinc-200"
                    placeholder="Telefone">
                <div
                    class="absolute transition-colors duration-300 left-2 fill-zinc-400 group-focus-within:fill-zinc-200">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="" viewBox="0 0 256 256">
                        <path
                            d="M222.37,158.46l-47.11-21.11-.13-.06a16,16,0,0,0-15.17,1.4,8.12,8.12,0,0,0-.75.56L134.87,160c-15.42-7.49-31.34-23.29-38.83-38.51l20.78-24.71c.2-.25.39-.5.57-.77a16,16,0,0,0,1.32-15.06l0-.12L97.54,33.64a16,16,0,0,0-16.62-9.52A56.26,56.26,0,0,0,32,80c0,79.4,64.6,144,144,144a56.26,56.26,0,0,0,55.88-48.92A16,16,0,0,0,222.37,158.46ZM176,208A128.14,128.14,0,0,1,48,80,40.2,40.2,0,0,1,82.87,40a.61.61,0,0,0,0,.12l21,47L83.2,111.86a6.13,6.13,0,0,0-.57.77,16,16,0,0,0-1,15.7c9.06,18.53,27.73,37.06,46.46,46.11a16,16,0,0,0,15.75-1.14,8.44,8.44,0,0,0,.74-.56L168.89,152l47,21.05h0s.08,0,.11,0A40.21,40.21,0,0,1,176,208Z">
                        </path>
                    </svg>
                </div>

            </div>
        </div>

        <div class="flex items-center justify-between gap-4">
            <div class="relative flex items-center justify-end w-full fill-zinc-400 group">
                <input type="email" id="email" formControlName="email" name="email"
                    class="w-full h-10 px-2 pl-10 transition-colors duration-300 rounded-lg bg-slate-900 text-zinc-200 focus:outline-none focus:group-fill-zinc-200"
                    placeholder="Email">
                <div
                    class="absolute transition-colors duration-300 left-2 fill-zinc-400 group-focus-within:fill-zinc-200">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="" viewBox="0 0 256 256">
                        <path
                            d="M128,24a104,104,0,0,0,0,208c21.51,0,44.1-6.48,60.43-17.33a8,8,0,0,0-8.86-13.33C166,210.38,146.21,216,128,216a88,88,0,1,1,88-88c0,26.45-10.88,32-20,32s-20-5.55-20-32V88a8,8,0,0,0-16,0v4.26a48,48,0,1,0,5.93,65.1c6,12,16.35,18.64,30.07,18.64,22.54,0,36-17.94,36-48A104.11,104.11,0,0,0,128,24Zm0,136a32,32,0,1,1,32-32A32,32,0,0,1,128,160Z">
                        </path>
                    </svg>
                </div>
            </div>
            <div class="relative flex items-center justify-end w-full fill-zinc-400 group">
                <p-calendar id="birthdate" placeholder="Data de Nascimento"
                    class="w-full h-10 px-2 pl-10 transition-colors duration-300 rounded-lg bg-slate-900 text-zinc-200 focus:outline-none focus:group-fill-zinc-200"
                    formControlName="birthdate" dateFormat="dd/mm/yy" [showIcon]="true" variant="filled">

                </p-calendar>
                <div
                    class="absolute transition-colors duration-300 left-2 fill-zinc-400 group-focus-within:fill-zinc-200">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="" viewBox="0 0 256 256">
                        <path
                            d="M232,112a24,24,0,0,0-24-24H136V79a32.06,32.06,0,0,0,24-31c0-28-26.44-45.91-27.56-46.66a8,8,0,0,0-8.88,0C122.44,2.09,96,20,96,48a32.06,32.06,0,0,0,24,31v9H48a24,24,0,0,0-24,24v23.33a40.84,40.84,0,0,0,8,24.24V200a24,24,0,0,0,24,24H200a24,24,0,0,0,24-24V159.57a40.84,40.84,0,0,0,8-24.24ZM112,48c0-13.57,10-24.46,16-29.79,6,5.33,16,16.22,16,29.79a16,16,0,0,1-32,0ZM40,112a8,8,0,0,1,8-8H208a8,8,0,0,1,8,8v23.33c0,13.25-10.46,24.31-23.32,24.66A24,24,0,0,1,168,136a8,8,0,0,0-16,0,24,24,0,0,1-48,0,8,8,0,0,0-16,0,24,24,0,0,1-24.68,24C50.46,159.64,40,148.58,40,135.33Zm160,96H56a8,8,0,0,1-8-8V172.56A38.77,38.77,0,0,0,62.88,176a39.69,39.69,0,0,0,29-11.31A40.36,40.36,0,0,0,96,160a40,40,0,0,0,64,0,40.36,40.36,0,0,0,4.13,4.67A39.67,39.67,0,0,0,192,176c.38,0,.76,0,1.14,0A38.77,38.77,0,0,0,208,172.56V200A8,8,0,0,1,200,208Z">
                        </path>
                    </svg>
                </div>
            </div>
        </div>

        <div class="flex items-start justify-between gap-4">

            <div class="flex flex-col w-full">
                <button type="button" (click)="toggleAddressForm()"
                    class="flex items-center justify-between w-full h-10 px-2 transition-colors duration-300 bg-slate-900 text-zinc-200 focus:outline-none focus:group-fill-zinc-200"
                    [ngClass]="{'rounded-lg fill-zinc-400': !showAddressForm, 'rounded-t-lg !text-violet-500 fill-violet-500': showAddressForm}">
                    <div class="flex gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="" viewBox="0 0 256 256">
                            <path
                                d="M128,64a40,40,0,1,0,40,40A40,40,0,0,0,128,64Zm0,64a24,24,0,1,1,24-24A24,24,0,0,1,128,128Zm0-112a88.1,88.1,0,0,0-88,88c0,31.4,14.51,64.68,42,96.25a254.19,254.19,0,0,0,41.45,38.3,8,8,0,0,0,9.18,0A254.19,254.19,0,0,0,174,200.25c27.45-31.57,42-64.85,42-96.25A88.1,88.1,0,0,0,128,16Zm0,206c-16.53-13-72-60.75-72-118a72,72,0,0,1,144,0C200,161.23,144.53,209,128,222Z">
                            </path>
                        </svg>
                        <span class="flex items-center justify-center flex-1">
                            Endereço
                        </span>
                    </div>
                    <svg *ngIf="showAddressForm" class="fill-red-600" xmlns="http://www.w3.org/2000/svg" width="24"
                        height="24" fill="" viewBox="0 0 256 256">
                        <path d="M224,128a8,8,0,0,1-8,8H40a8,8,0,0,1,0-16H216A8,8,0,0,1,224,128Z"></path>
                    </svg>
                </button>

                <div formGroupName="addresses" *ngIf="showAddressForm" class="w-full px-12 pb-4 bg-slate-900"
                    [ngClass]="{'rounded-lg': !showAddressForm, 'rounded-b-lg': showAddressForm}">
                    <div class="relative flex items-center justify-end border-b border-zinc-600 fill-zinc-400 group">
                        <input type="text" id="street" formControlName="street" name="street"
                            class="w-full h-10 px-2 transition-colors duration-300 rounded-lg bg-slate-900 text-zinc-200 focus:outline-none focus:group-fill-zinc-200"
                            placeholder="Rua">

                    </div>
                    <div class="relative flex items-center justify-end border-b fill-zinc-400 border-zinc-600 group">
                        <input type="text" id="city" formControlName="city" name="city"
                            class="w-full h-10 px-2 transition-colors duration-300 rounded-lg bg-slate-900 text-zinc-200 focus:outline-none focus:group-fill-zinc-200"
                            placeholder="Cidade">

                    </div>
                    <div class="relative flex items-center justify-end border-b fill-zinc-400 border-zinc-600 group">
                        <input type="text" id="state" formControlName="state" name="state"
                            class="w-full h-10 px-2 transition-colors duration-300 rounded-lg bg-slate-900 text-zinc-200 focus:outline-none focus:group-fill-zinc-200"
                            placeholder="Estado">

                    </div>
                    <div class="relative flex items-center justify-end border-b fill-zinc-400 border-zinc-600 group">
                        <input type="text" id="country" formControlName="country" name="country"
                            class="w-full h-10 px-2 transition-colors duration-300 rounded-lg bg-slate-900 text-zinc-200 focus:outline-none focus:group-fill-zinc-200"
                            placeholder="País">

                    </div>
                    <div class="relative flex items-center justify-end border-b border-zinc-600 fill-zinc-400 group">
                        <input type="text" id="zip" formControlName="zip" name="zip"
                            class="w-full h-10 px-2 transition-colors duration-300 rounded-lg bg-slate-900 text-zinc-200 focus:outline-none focus:group-fill-zinc-200"
                            placeholder="CEP">

                    </div>
                </div>
            </div>
            <div class="flex flex-col w-full">
                <button type="button" (click)="toggleCategoryForm()"
                    class="flex items-center justify-between w-full h-10 px-2 transition-colors duration-300 bg-slate-900 text-zinc-200 focus:outline-none focus:group-fill-zinc-200"
                    [ngClass]="{'rounded-lg fill-zinc-400': !showCategoryForm, 'rounded-t-lg !text-violet-500 fill-violet-500': showCategoryForm}">
                    <div class="flex gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="" viewBox="0 0 256 256">
                            <path
                                d="M224,64H154.67L126.93,43.2a16.12,16.12,0,0,0-9.6-3.2H72A16,16,0,0,0,56,56V72H40A16,16,0,0,0,24,88V200a16,16,0,0,0,16,16H192.89A15.13,15.13,0,0,0,208,200.89V184h16.89A15.13,15.13,0,0,0,240,168.89V80A16,16,0,0,0,224,64ZM192,200H40V88H85.33l29.87,22.4A8,8,0,0,0,120,112h72Zm32-32H208V112a16,16,0,0,0-16-16H122.67L94.93,75.2a16.12,16.12,0,0,0-9.6-3.2H72V56h45.33L147.2,78.4A8,8,0,0,0,152,80h72Z">
                            </path>
                        </svg>
                        <span class="flex items-center justify-center flex-1">
                            Categorias
                        </span>
                    </div>
                    <svg *ngIf="showCategoryForm" class="fill-red-600" xmlns="http://www.w3.org/2000/svg" width="24"
                        height="24" fill="" viewBox="0 0 256 256">
                        <path d="M224,128a8,8,0,0,1-8,8H40a8,8,0,0,1,0-16H216A8,8,0,0,1,224,128Z"></path>
                    </svg>
                </button>

                <div *ngIf="showCategoryForm" class="flex flex-col w-full gap-6 p-4 px-12 duration-300 bg-slate-900"
                    [ngClass]="{'rounded-lg': !showCategoryForm, 'rounded-b-lg': showCategoryForm}">

                    <div class="">
                        <ng-container *ngIf="chosenCategories.length == 0">
                            <span class="text-zinc-400">Selecione uma categoria</span>
                        </ng-container>
                        <div class="flex flex-wrap gap-2">
                            <button *ngFor="let category of chosenCategories"
                                (click)="removeCategory(category)"
                                class="flex items-center justify-between gap-1 px-1 rounded-md bg-violet-600 text-zinc-200 hover:bg-violet-800">
                                {{ category.name }}
                                <svg class="fill-zinc-200" xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                    fill="" viewBox="0 0 256 256">
                                    <path
                                        d="M165.66,101.66,139.31,128l26.35,26.34a8,8,0,0,1-11.32,11.32L128,139.31l-26.34,26.35a8,8,0,0,1-11.32-11.32L116.69,128,90.34,101.66a8,8,0,0,1,11.32-11.32L128,116.69l26.34-26.35a8,8,0,0,1,11.32,11.32ZM232,128A104,104,0,1,1,128,24,104.11,104.11,0,0,1,232,128Zm-16,0a88,88,0,1,0-88,88A88.1,88.1,0,0,0,216,128Z">
                                    </path>
                                </svg>
                            </button>
                        </div>
                    </div>

                    <div *ngIf="availableCategories.length > 0" class="flex flex-col items-start gap-1">
                        <div class="flex flex-wrap items-center justify-start gap-2 fill-zinc-200">
                            <button 
                            (click)="selectCategory(category)"
                            type="button" class="flex" *ngFor="let category of availableCategories; let i = index"
                                class="flex items-center justify-center px-2 py-1 text-xs font-semibold duration-300 border-2 border-transparent border-dashed rounded-sm border-spacing-5 text-zinc-200 hover:opacity-75"
                                [ngClass]="category.color" draggable="true"
                                (dragstart)="onDragStart($event, category.id)" (dragend)="onDragEnd($event)">
                                {{ category.name }}
                            </button>
                            <button (click)="toggleNewCategory()"
                                class="flex items-center justify-center gap-1 p-1 bg-blue-900 rounded-sm text-zinc-200 hover:bg-blue-800">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill=""
                                    viewBox="0 0 256 256">
                                    <path
                                        d="M213.66,82.34l-56-56A8,8,0,0,0,152,24H56A16,16,0,0,0,40,40V216a16,16,0,0,0,16,16H200a16,16,0,0,0,16-16V88A8,8,0,0,0,213.66,82.34ZM160,51.31,188.69,80H160ZM200,216H56V40h88V88a8,8,0,0,0,8,8h48V216Zm-40-64a8,8,0,0,1-8,8H136v16a8,8,0,0,1-16,0V160H104a8,8,0,0,1,0-16h16V128a8,8,0,0,1,16,0v16h16A8,8,0,0,1,160,152Z">
                                    </path>
                                </svg>
                                <span>
                                    Nova categoria
                                </span>
                            </button>
                        </div>
                    </div>

                    <div *ngIf="isNewCategoryVisible"
                        class="relative flex items-center justify-end w-full border-b border-zinc-600 fill-zinc-400 group max-w-48">
                        <input type="text" id="categories" formControlName="categories" name="categories"
                            class="w-full h-10 px-2 transition-colors duration-300 rounded-lg bg-slate-900 text-zinc-200 focus:outline-none focus:group-fill-zinc-200"
                            placeholder="Nova Categoria">
                        <button type="button" (click)="addNewCategory()"
                            class="w-auto px-2 py-1 text-white duration-300 bg-blue-900 rounded hover:bg-blue-600">Criar</button>
                    </div>

                    <div 
                        class="flex items-center justify-center h-12 mt-4 border-2 border-dashed rounded-sm text-zinc-400 border-slate-800"
                        (drop)="onDrop($event)" (dragover)="onDragOver($event)
                        ">
                        Arraste aqui para excluir
                    </div>
                </div>
            </div>
        </div>

        <div class="flex items-center justify-end gap-4 mt-8">
            <button type="button" (click)="onCancel()"
                class="w-full px-4 py-2 text-white duration-300 rounded bg-blue-950 hover:bg-blue-900">Cancelar</button>
            <button [disabled]="!contactForm.valid" type="submit"
                class="w-full px-4 py-2 text-white duration-300 bg-blue-600 rounded disabled:opacity-70 disabled:cursor-not-allowed hover:bg-blue-800">Salvar</button>
        </div>
    </form>
</div>